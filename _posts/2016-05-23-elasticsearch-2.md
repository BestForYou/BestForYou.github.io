---
layout: post
title: 1.2 - ElasticSearch 概念
subtitle: 
author: pizida
date: 2016-05-23 16:00:07 +0800
categories: 
tag: ElasticSearch
---

### ElasticSearch的一些基本概念

需要我们注意的是，这些概念理解只是解释其含义，不推荐强制翻译成中文。

![](http://7xr9mw.com1.z0.glb.clouddn.com/16-5-23/42118915.jpg)

#### 1，Elasticsearch集群的概念（cluster）

在一个分布式系统里面,可以通过多个elasticsearch运行实例组成一个集群,这个集群里面有一个节点叫做主节点(master),elasticsearch是去中心化的,所以这里的主节点是动态选举出来的,不存在单点故障。

在同一个子网内，只需要在每个节点上设置相同的集群名,elasticsearch就会自动的把这些集群名相同的节点组成一个集群。节点和节点之间通讯以及节点之间的数据分配和平衡全部由elasticsearch自动管理。

在外部看来elasticsearch就是一个整体。

ES可以以单点或者集群方式运行，以一个整体对外提供search服务的所有节点组成cluster，组成这个cluster的各个节点叫做node。

--------------------------------------------------
#### 2，Elasticsearch 节点(node)
每一个运行实例称为一个节点,每一个运行实例既可以在同一机器上,也可以在不同的机器上。

所谓运行实例,就是一个服务器进程，在测试环境中可以在一台服务器上运行多个服务器进程，在生产环境中建议每台服务器运行一个服务器进程。

 一个节点属于一个集群。通常情况下一个服务器有一个节点，但有时候为了测试方便，一台服务器也可以有多个节点。在启动时，一个节点将使用广播来发现具有相同群集名称的现有群集，并将尝试加入该群集。
 
--------------------------------------------------
 
#### 3，Elasticsearch 路由(routing)

当存储一个文档的时候，他会存储在一个唯一的主分片中，具体哪个分片是通过散列值的进行选择。默认情况下，这个值是由文档的id生成。如果文档有一个指定的父文档，从父文档ID中生成，该值可以在存储文档的时候进行修改。
 
--------------------------------------------------

#### 4，Elasticsearch 分片(shards)

Elasticsearch 它会把一个索引分解为多个小的索引，每一个小的索引就叫做分片。

这是ES提供分布式搜索的基础，其含义为将一个完整的index分成若干部分存储在相同或不同的节点上，这些组成index的部分就叫做shard。

分片之后就可以把各个分片分配到不同的节点中去。

--------------------------------------------------

#### 5，Elasticsearch 主分片(primary shard)

每个文档都存储在一个分片中，当你存储一个文档的时候，系统会首先存储在主分片中，然后会复制到不同的副本中。默认情况下，一个索引有5个主分片。你可以在事先制定分片的数量，当分片一旦建立，分片的数量则不能修改。

--------------------------------------------------

#### 6，Elasticsearch副本分片(replica shard)

每一个分片有零个或多个副本。副本主要是主分片的复制，其中有两个目的：

1、增加高可用性：当主分片失败的时候，可以从副本分片中选择一个作为主分片。

2、提高性能：当查询的时候可以到主分片或者副本分片中进行查询。默认情况下，一个主分配有一个副本，但副本的数量可以在后面动态的配置增加。副本必须部署在不同的节点上，不能部署在和主分片相同的节点上。

--------------------------------------------------

![](http://7xr9mw.com1.z0.glb.clouddn.com/16-5-23/12746096.jpg)

#### 7，Elasticsearch索引(index)
Elasticsearch里的索引概念是名词而不是动词，在elasticsearch里它支持多个索引。

优点类似于关系数据库里面每一个服务器可以支持多个数据库是一个道理，在每一索引下面又可以支持多种类型，这又类似于关系数据库里面的一个数据库可以有多张表一样。

索引就像关系数据库中的数据库，每个索引有不同字段，可以对应不同的类型；每个索引都可以有一个或者多个主索引片，同时每个索引还可以有零个或者多个副本索引片。

这是ES存储数据的地方，类似于关系数据库的database。

--------------------------------------------------

#### 8，Elasticsearch 文档类型（Document type）
嗯，类似关系数据库的表，主要功能是将完全不同schema（这个概念以后会讲到，不急）的数据分开，一个index里面可以有若干个Document type。

类型类似关系数据库中的表。每种类型都可以指定不同的列。映射定义文档中的每个字段的类型，并可以指定如何分析。

--------------------------------------------------

#### 9，Elasticsearch 文档 (Document）
一个文档是一个JSON格式的字符串存储在Elasticsearch中。它就像在关系数据库中的表中的一行。每个存储在索引中的一个文件都有一个类型和一个id，每个文件都是一个json对象，存储了零个或者多个字段，或者键值对。原始的json文档被存储在一个叫做_source的字段中。当搜索文档的时候默认返回的就是这个字段。

--------------------------------------------------

#### 10，Elasticsearch 字段 （Filed）
一个文档中包含零个或者多个字段，字段可以是一个简单的值（例如字符串、整数、日期），也可以是一个数组或对象的嵌套结构。字段类似于关系数据库中的表中的列。每个字段都对应一个字段类型，例如整数、字符串、对象等。字段还可以指定如何分析该字段的值。

类似关系数据库的某一列，这是ES数据存储的最小单位。

--------------------------------------------------
#### 11，Elasticsearch 来源字段(source field)

默认情况下，你的原文档将被存储在_source这个字段中，当你查询的时候也是返回这个字段。这允许您可以从搜索结果中访问原始的对象，这个对象返回一个精确的json字符串，这个对象不显示索引分析后的其他任何数据。

--------------------------------------------------
#### 12，Elasticsearch 主键(id)

id是一个文件的唯一标识，如果在存库的时候没有提供id，系统会自动生成一个id，文档的index/type/id必须是唯一的。


--------------------------------------------------
#### 13，Elasticsearch 索引词(term)
在elasticsearch中索引词(term)是一个能够被索引的精确值。foo，Foo Foo几个单词是不相同的索引词。索引词(term)是可以通过term查询进行准确的搜索。

--------------------------------------------------
#### 14，Elasticsearch 文本(text)
文本是一段普通的非结构化文字，通常，文本会被分析称一个个的索引词，存储在elasticsearch的索引库中，为了让文本能够进行搜索，文本字段需要事先进行分析；当对文本中的关键词进行查询的时候，搜索引擎应该根据搜索条件搜索出原文本。

--------------------------------------------------
#### 15，Elasticsearch 分析(analysis)

分析是将文本转换为索引词的过程，分析的结果依赖于分词器，比如： FOO BAR, Foo-Bar, foo bar这几个单词有可能会被分析成相同的索引词foo和bar，这些索引词存储在elasticsearch的索引库中。当用 FoO:bAR进行全文搜索的时候，搜索引擎根据匹配计算也能在索引库中搜索出之前的内容。这就是elasticsearch的搜索分析。索引词(term)

在elasticsearch中索引词(term)是一个能够被索引的精确值。foo，Foo Foo几个单词是不相同的索引词。索引词(term)是可以通过term查询进行准确的搜索。

--------------------------------------------------
#### 16，Elasticsearch副本(replicas)


Elasticsearch的每一个分片都可以有0到多个副本，而每一个副本也都是分片的完整拷贝，好处是可以用它来增加速度的同时也提高了系统的容错性。

一旦Elasticsearch的某个节点数据损坏或则服务不可用的时候，那么这个时就可以用其他节点来代替坏掉的节点，以达到高考用的目的。

和replication通常指的都是一回事，即index的冗余备份，可以用于防止数据丢失，或者用来做负载分担。

--------------------------------------------------
#### 17，Elasticsearch 的recovery概念


Elasticsearch 的recovery代表的是数据恢复或者叫做数据重新分布。

elasticsearch 当有节点加入或退出时时它会根据机器的负载对索引分片进行重新分配，当挂掉的节点再次重新启动的时候也会进行数据恢复。

--------------------------------------------------
#### 18，Elasticsearch river


Elasticsearch river 代表的是一个数据源，这也是其它存储方式（比如：数据库）同步数据到 elasticsearch 的一个方法。

它是以插件方式存在的一个 elasticsearch 服务，通过读取 river 中的数据并把它索引到 elasticsearch 当中去，官方的 river 有 couchDB、RabbitMQ、Twitter、Wikipedia。

--------------------------------------------------
#### 19，Elasticsearch 的 gateway 概念


gateway 代表 elasticsearch 索引的持久化存储方式，elasticsearch 默认是先把索引存放到内存中去，当内存满了的时候再持久化到硬盘里。

当这个 elasticsearch 集群关闭或者再次重新启动时就会从 gateway 中读取索引数据。

elasticsearch 支持多种类型的 gateway，有本地文件系统（默认），分布式文件系统，Hadoop 的 HDFS 和 amazon 的 s3 云存储服务。

--------------------------------------------------
#### 20，Elasticsearch的discovery.zen概念


discovery.zen代表 elasticsearch 的自动节点发现机制，而且 elasticsearch还是一个基于 p2p 的系统。

首先它它会通过以广播的方式去寻找存在的节点，然后再通过多播协议来进行节点之间的通信，于此同时也支持点对点的交互操作。

--------------------------------------------------
#### 21，Elasticsearch里Transport的概念


Transport代表 elasticsearch 内部的节点或者集群与客户端之间的交互方式。

默认的内部是使用 tcp 协议来进行交互的，同时它支持 http 协议（json格式）、thrift、servlet、memcached、zeroMQ等多种的传输协议（通过插件方式集成）。

--------------------------------------------------
部分转自 塞克兰德 http://my.oschina.net/		